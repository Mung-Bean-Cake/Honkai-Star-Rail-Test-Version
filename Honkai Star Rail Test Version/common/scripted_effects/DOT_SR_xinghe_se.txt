xinghe_create_effect = {
    optimize_memory
    from = {
        random_system_planet = {
            limit = {
                NOR = {
                    is_colonizable = yes
                    is_colony = yes
                    is_star = yes
                    is_artificial = yes
                    is_planet_class = pc_crystal_asteroid
                    is_planet_class = pc_ice_asteroid
                    is_planet_class = pc_rare_crystal_asteroid
                    is_planet_class = pc_shielded_white
                    is_planet_class = pc_shielded_red
                    is_planet_class = pc_shielded_yellow
                    is_planet_class = pc_astral_scar
                }
            }
            random_list = {
                7 = {
                    change_pc = pc_shielded_white
                }
                2 = {
                    change_pc = pc_shielded_yellow
                    prev = {
                        random_list = {
                            1 = {}
                            1 = {
                                spawn_random_storm = {
                                    type = xinghe_small_storm
                                    cosmic_storm_start_position = this
                                    immediate = yes
                                }
                            }
                        }
                    }
                }
                1 = {
                    change_pc = pc_shielded_red
                    prev = {
                        spawn_random_storm = {
                            type = xinghe_big_storm
                            cosmic_storm_start_position = this
                            immediate = yes
                        }
                    }
                }
            }
            set_all_comms_surveyed = yes
        }
    }
}
hsr_generate_start_deposits = {
    optimize_memory
    clear_deposits = yes
    if = {
        limit = {
            is_planet_class = pc_continental
        }

        # 3 + 3 energy
        add_deposit = d_hot_springs
        add_deposit = d_rushing_waterfalls
        add_deposit = d_tempestous_mountain

        # 3 + 3 mining
        add_deposit = d_veiny_cliffs
        add_deposit = d_prosperous_mesa
        add_deposit = d_rich_mountain

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_rugged_woods
        add_deposit = d_fertile_lands
    }

    if = {
        limit = {
            is_planet_class = pc_tropical
        }

        # 3 + 3 energy
        add_deposit = d_hot_springs
        add_deposit = d_rushing_waterfalls
        add_deposit = d_tempestous_mountain

        # 3 + 3 mining
        add_deposit = d_mineral_fields
        add_deposit = d_prosperous_mesa
        add_deposit = d_submerged_ore_veins

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_green_hills
        add_deposit = d_lush_jungle
    }

    if = {
        limit = {
            is_planet_class = pc_ocean
        }

        # 3 + 3 energy
        add_deposit = d_hot_springs
        add_deposit = d_rushing_waterfalls
        add_deposit = d_underwater_vent

        # 3 + 3 mining
        add_deposit = d_mineral_fields
        add_deposit = d_ore_rich_caverns
        add_deposit = d_submerged_ore_veins

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_green_hills
        add_deposit = d_lush_jungle
    }

    if = {
        limit = {
            is_planet_class = pc_arctic
        }

        # 3 + 3 energy
        add_deposit = d_hot_springs
        add_deposit = d_frozen_gas_lake
        add_deposit = d_geothermal_vent

        # 3 + 3 mining
        add_deposit = d_veiny_cliffs
        add_deposit = d_ore_rich_caverns
        add_deposit = d_rich_mountain

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_lichen_fields
        add_deposit = d_fungal_caves
    }

    if = {
        limit = {
            is_planet_class = pc_tundra
        }

        # 3 + 3 energy
        add_deposit = d_hot_springs
        add_deposit = d_frozen_gas_lake
        add_deposit = d_geothermal_vent

        # 3 + 3 mining
        add_deposit = d_mineral_fields
        add_deposit = d_ore_rich_caverns
        add_deposit = d_rich_mountain

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_forgiving_tundra
        add_deposit = d_fungal_caves
    }

    if = {
        limit = {
            is_planet_class = pc_alpine
        }

        # 3 + 3 energy
        add_deposit = d_hot_springs
        add_deposit = d_frozen_gas_lake
        add_deposit = d_tempestous_mountain

        # 3 + 3 mining
        add_deposit = d_veiny_cliffs
        add_deposit = d_ore_rich_caverns
        add_deposit = d_rich_mountain

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_forgiving_tundra
        add_deposit = d_fungal_caves
    }

    if = {
        limit = {
            is_planet_class = pc_desert
        }

        # 3 + 3 energy
        add_deposit = d_arid_highlands
        add_deposit = d_searing_desert
        add_deposit = d_geothermal_vent

        # 3 + 3 mining
        add_deposit = d_mineral_fields
        add_deposit = d_ore_rich_caverns
        add_deposit = d_rich_mountain

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_nutritious_mudland
        add_deposit = d_great_river
    }

    if = {
        limit = {
            is_planet_class = pc_arid
        }

        # 3 + 3 energy
        add_deposit = d_arid_highlands
        add_deposit = d_searing_desert
        add_deposit = d_geothermal_vent

        # 3 + 3 mining
        add_deposit = d_veiny_cliffs
        add_deposit = d_ore_rich_caverns
        add_deposit = d_rich_mountain

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_bountiful_plains
        add_deposit = d_great_river
    }

    if = {
        limit = {
            is_planet_class = pc_savannah
        }

        # 3 + 3 energy
        add_deposit = d_arid_highlands
        add_deposit = d_searing_desert
        add_deposit = d_geothermal_vent

        # 3 + 3 mining
        add_deposit = d_mineral_fields
        add_deposit = d_prosperous_mesa
        add_deposit = d_submerged_ore_veins

        # 4 + 3 farming (lithoids swap 3 for minerals)
        add_deposit = d_bountiful_plains
        add_deposit = d_fertile_lands
    }

    if = {
        limit = {
            is_planet_class = pc_relic
        }

        set_planet_size = 22

        # 6 blockers
        add_deposit = d_ruined_arcology
        add_deposit = d_ruined_arcology
        add_deposit = d_ruined_arcology
        add_deposit = d_ruined_arcology
        add_deposit = d_ruined_arcology
        add_deposit = d_ruined_arcology

        # 3 + 3 energy
        add_deposit = d_arid_highlands
        add_deposit = d_searing_desert
        add_deposit = d_geothermal_vent

        # 3 + 3 mining
        add_deposit = d_mineral_fields
        add_deposit = d_prosperous_mesa
        add_deposit = d_submerged_ore_veins

        # 4 + 3 farming
        add_deposit = d_bountiful_plains
        add_deposit = d_fertile_lands
    }

    if = {
        limit = {
            is_planet_class = pc_volcanic
        }

        # Mining - 9 total
        # +2 each, RL so not all homeworlds are the same
        while = {
            count = 2
            random_list = {
                1 = { add_deposit = d_volcanic_rich_mountain }
                1 = { add_deposit = d_volcanic_mineral_fields }
                1 = { add_deposit = d_volcanic_mineral_layers }
                1 = { add_deposit = d_volcanic_weak_crust }
            }
        }
        # +1 each
        add_deposit = d_volcanic_ore_veins
        add_deposit = d_volcanic_mineral_hills
        # +3
        add_deposit = d_volcanic_lava_river

        # Polytechnic - 6 total
        # +2 each, RL so not all homeworlds are the same
        while = {
            count = 3
            random_list = {
                1 = { add_deposit = d_volcanic_stable_plateaus }
                1 = { add_deposit = d_volcanic_tranquil_flatlands }
                1 = { add_deposit = d_volcanic_intraplate }
                1 = { add_deposit = d_volcanic_basalt_plains }
            }
        }
    }
}
xinghe_remove_effect = {
    optimize_memory
    if = {
        limit = { is_planet_class = pc_shielded_white }
        add_modifier = { modifier = xinghe_small_modifier days = -1 }
    }
    else_if = {
        limit = { is_planet_class = pc_shielded_yellow }
        add_modifier = { modifier = xinghe_medium_modifier days = -1 }
        random_list = {
            1 = {

            }
            1 = {
                This.solar_system = {
                    every_cosmic_storm = {
                        limit = { is_storm_type = xinghe_small_storm }
                        destroy_cosmic_storm = yes

                    }
                    random_system_ambient_object = {
                        limit = {
                            has_ambient_object_flag = space_storm_object
                        }
                        destroy_ambient_object = this
                    }
                }
            }
        }
    }
    else_if = {
        limit = { is_planet_class = pc_shielded_red }
        add_modifier = { modifier = xinghe_large_modifier days = -1 }
    }
}
xinghe_storm_add = {
    set_star_flag = storm_system
    set_global_flag = cosmic_storm_has_occurred

    inline_script = {
        script = cosmic_storms/StormVisuals
        STORM_NAME = "electric_storm"
    }
}
xinghe_big_storm_add = {
    set_star_flag = storm_system
    set_global_flag = cosmic_storm_has_occurred

    inline_script = {
        script = cosmic_storms/StormVisuals
        STORM_NAME = "nexus_storm"
    }
}
xinghe_storm_remove = {
    remove_storm_visuals_effect = yes
    remove_star_flag = storm_system
    #electric_storm_apply_aftermath_modifier = yes
    #electric_storm_apply_deposits = yes
}